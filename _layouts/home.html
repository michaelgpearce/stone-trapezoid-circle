---
layout: default
---

<div class="home">
  <h1 class="page-heading">{{ page.title }}</h1>

  <script>
    function draw() {
      const pi = Math.PI
      const drawing = document.getElementById('drawing')
      const form = document.getElementById('form')
      const kerf = parseFloat(form.kerf.value)
      const length = parseFloat(form.length.value)
      const depth = parseFloat(form.depth.value)
      const diameter = parseFloat(form.diameter.value) * 12.0
      const removeStones = parseInt(form.removeStones.value)
      const radius = diameter / 2.0

      const outerCircumference = pi * diameter
      const innerCircumference = pi * (diameter - depth * 2)

      const ratio = innerCircumference / outerCircumference

      const longLength = length / (1 + ratio)
      const shortLength = length - longLength
      const anglePerStone = calculateAnglePerStone(longLength, shortLength, depth)

      const stoneCount = Math.floor(360.0 / anglePerStone) - removeStones

      updateStoneCount(stoneCount)
      updateStoneInfo(longLength, shortLength, kerf)

      const padding = 6

      const viewBox = [
        0 - radius - padding,
        0 - radius - padding,
        2.0 * (radius + padding),
        2.0 * (radius + padding),
      ].join(' ')

      const stoneSvgs = new Array(stoneCount).fill(undefined).map((_, index) => {
        return buildStoneSvg(
          index,
          longLength,
          shortLength,
          depth,
          radius,
        )
      })
      const stonesSvg = [
        `<g transform="rotate(${calculateStoneRotation(stoneCount, anglePerStone)})">`,
        stoneSvgs,
        '</g>',
      ].join('')

      drawing.innerHTML = [
        `<svg style="max-width: 600px; max-height: 600px; border: 1px solid black" viewBox="${viewBox}" preserveAspectRatio="none">`,
        buildCircleSvg(radius),
        stonesSvg,
        '</svg>'
      ].join('')
    }

    function calculateStoneRotation(stoneCount, anglePerStone) {
      const unusedAngle = 360.0 - (stoneCount * anglePerStone)

      return unusedAngle * 0.5 + anglePerStone * 0.5 + 180.0
    }

    function calculateAnglePerStone(longLength, shortLength, depth) {
      const angleRadians = Math.atan((longLength - shortLength) / depth) * 2.0

      return angleRadians * 180.0 / Math.PI
    }

    function buildCircleSvg(radius) {
      const style = 'fill:blue; fill-opacity: .75;' // stroke:blue; stroke-width:1;

      return `<circle cx="0" cy="0" r="${radius}" style="${style}" />`
    }

    function buildStoneSvg(stoneIndex, longLength, shortLength, depth, radius) {
      const rotation = stoneIndex * calculateAnglePerStone(longLength, shortLength, depth)

      return [
        `<g transform="rotate(${rotation})">`,
        buildTrapezoidSvg(
          [-longLength, -radius],
          [longLength, -radius],
          [shortLength, -radius + depth],
          [-shortLength, -radius + depth],
        ),
        buildLineSvg(
          [0, -radius],
          [0, -radius + depth],
        ),
        '</g>'
      ].join('')
    }

    function buildLineSvg(point1, point2) {
      return [
        `<line x1="${point1[0]}" y1="${point1[1]}" x2="${point2[0]}" y2="${point2[1]}" style="stroke:black; stroke-width:0.1; stroke-dasharray:1" />`
      ].join('')
    }

    function buildTrapezoidSvg(topLeft, topRight, bottomRight, bottomLeft) {
      return [
        '<polygon points="',
        buildPoint(topLeft),
        buildPoint(topRight),
        buildPoint(bottomRight),
        buildPoint(bottomLeft),
        `" style="fill:red; stroke:black; stroke-width:0.1; fill-opacity: .75" />`
      ].join('')
    }

    function buildPoint(point) {
      return [
        point[0],
        point[1],
      ].join(',') + ' '
    }

    function updateStoneCount(stoneCount) {
      document.getElementById('stoneCount').innerHTML = stoneCount
    }

    function updateStoneInfo(longLength, shortLength, kerf) {
      const halfKerf = kerf * 0.5

      document.getElementById('longCut').innerHTML = longLength.toFixed(3)
      document.getElementById('shortCut').innerHTML = shortLength.toFixed(3)
      document.getElementById('longCutWithKerf').innerHTML = (longLength - halfKerf).toFixed(3)
      document.getElementById('shortCutWithKerf').innerHTML = (shortLength - halfKerf).toFixed(3)
      document.getElementById('longSide').innerHTML = (longLength * 2.0 - kerf).toFixed(3)
      document.getElementById('shortSide').innerHTML = (shortLength * 2.0 - kerf).toFixed(3)
    }

  </script>

  <form id="form" onsubmit="draw(); return false">
    <label for="length">Stone Length (inches)</label>
    <input type="text" id="length" name="length" value="12">
    <br>
    <label for="depth">Stone Depth (inches)</label>
    <input type="text" id="depth" name="depth" value="8">
    <br>
    <label for="diameter">Circle Diameter (feet)</label>
    <input type="text" id="diameter" name="diameter" value="11">
    <br>
    <label for="kerf">Cut Thickness (a.k.a. Kerf) (inches)</label>
    <input type="text" id="kerf" name="kerf" value="0.125">
    <br>
    <label for="removeStones">Remove Stones</label>
    <input type="text" id="removeStones" name="removeStones" value="10">
    <br>
    <input type="submit" value="Update">
  </form>

  <h4>Stone Count</h4>
  <div id="stoneCount"></div>

  <h4>Stone Cuts</h4>
  <h5>Cut Lengths</h5>
  <div id="cutLengths">
    <span id="longCut"></span> inches / <span id="shortCut"></span> inches
  </div>
  <h5>Cut Lengths (with kerf)</h5>
  <div id="cutLengthsWithKerf">
    <span id="longCutWithKerf"></span> inches / <span id="shortCutWithKerf"></span> inches
  </div>
  <h5>Side Lengths (with kerf)</h5>
  <div id="sideLengths">
    <span id="longSide"></span> inches / <span id="shortSide"></span> inches
  </div>

  <div id="drawing" />

  <script type="text/javascript">draw()</script>

</div>
